<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Compress PDF – PDF Tools Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #fef9d7 0%, #d9f99d 100%); }
    .drop-zone { transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); border: 2px dashed #e0e0e0; }
    .drop-zone.dragover { border-color: #eab308; background: #fef9d7; transform: scale(1.02); box-shadow: 0 4px 6px rgba(234, 179, 8, 0.1); }
    .progress-bar { height: 4px; background: linear-gradient(to right, #eab308, #f97316); transition: width 0.4s ease-out; }
    .btn-download { background: linear-gradient(135deg, #eab308 0%, #f97316 100%); box-shadow: 0 10px 15px -3px rgba(234, 179, 8, 0.1), 0 4px 6px -2px rgba(234, 179, 8, 0.05); transition: all 0.3s ease; }
    .btn-download:hover { transform: translateY(-2px); box-shadow: 0 15px 20px -5px rgba(234, 179, 8, 0.2); }
    .pulse { animation: pulse 2s infinite ease-in-out; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    .fade-in { animation: fadeIn 0.5s ease-in; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">

  <!-- Back Button -->
  <div class="max-w-3xl mx-auto mb-8">
    <a href="index.html" class="inline-flex items-center text-yellow-600 hover:text-yellow-800 font-medium text-sm">
      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
      Back to Dashboard
    </a>
  </div>

  <div class="max-w-3xl mx-auto" x-data="compressTool()">
    <div class="text-center mb-12 fade-in">
      <h1 class="text-4xl font-bold text-gray-900 mb-2">Compress PDF</h1>
      <p class="text-lg text-gray-600">Reduce size with any compression engine.</p>
    </div>

    <!-- File Upload -->
    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">PDF File</label>
      <div class="drop-zone rounded-xl p-6 bg-white shadow-md cursor-pointer"
           :class="{ 'dragover': dragging }"
           @dragover.prevent="dragging = true"
           @dragleave.prevent="dragging = false"
           @drop.prevent="handleDrop($event)"
           @click="$refs.fileInput.click()">
        <input type="file" accept=".pdf" x-ref="fileInput" class="hidden" @change="handleFile($event)" />
        <div class="text-center">
          <svg class="w-12 h-12 mx-auto mb-3 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
          </svg>
          <p class="text-sm text-gray-600" x-show="!file">Drag & drop or click to upload PDF</p>
          <p class="text-sm font-medium text-yellow-600" x-show="file" x-text="file.name"></p>
        </div>
      </div>
    </div>

    <!-- Compression Level -->
    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">Compression Level</label>
      <select x-model="compression" class="w-full rounded-xl border-gray-300 shadow-sm focus:border-yellow-500 focus:ring-yellow-500">
        <option value="75">75% (Recommended)</option>
        <option value="50">50% (High)</option>
        <option value="25">25% (Max)</option>
        <option value="custom">Custom KB/MB</option>
      </select>
    </div>

    <!-- Custom Size -->
    <div class="mb-6" x-show="compression === 'custom'">
      <label class="block text-sm font-medium text-gray-700 mb-2">Target Size (e.g., 500KB or 2MB)</label>
      <input type="text" x-model="customSize" placeholder="500KB" class="w-full rounded-xl border-gray-300 shadow-sm focus:border-yellow-500 focus:ring-yellow-500" />
    </div>

    <!-- Library Selection -->
    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">Compression Engine</label>
      <select x-model="library" class="w-full rounded-xl border-gray-300 shadow-sm focus:border-yellow-500 focus:ring-yellow-500">
        <option value="fitz">PyMuPDF (fitz) – Best quality/size control</option>
        <option value="ghostscript">Ghostscript – Max compression</option>
        <option value="pikepdf">pikepdf – Lossless, fast</option>
        <option value="qpdf">qpdf – Linearize + compress</option>
        <option value="pdfminer.six">pdfminer.six – Text-only (lossy)</option>
        <option value="pdfrw">pdfrw – Re-save only</option>
      </select>
    </div>

    <!-- Compress Button -->
    <button @click="upload" :disabled="uploading" class="w-full py-3 px-4 bg-yellow-600 text-white font-semibold rounded-xl shadow-md hover:bg-yellow-700 transition disabled:opacity-50">
      <span x-show="!uploading">Compress PDF</span>
      <span x-show="uploading">Compressing...</span>
    </button>

    <!-- Progress -->
    <div class="mt-6" x-show="uploading">
      <div class="bg-yellow-100 rounded-full overflow-hidden">
        <div class="progress-bar" :style="{ width: progress + '%' }"></div>
      </div>
      <p class="text-center text-sm text-gray-600 mt-2" x-text="`Compressing... ${progress}%`"></p>
    </div>

    <!-- Download -->
    <div class="mt-6" x-show="downloadUrl">
      <a :href="downloadUrl" download="compressed.pdf" class="block py-3 px-4 bg-green-600 text-white font-semibold rounded-xl shadow-md hover:bg-green-700 transition pulse text-center">
        Download Compressed PDF
      </a>
    </div>
  </div>

  <script>
    function compressTool() {
      return {
        file: null,
        dragging: false,
        compression: '75',
        customSize: '',
        library: 'fitz',  // default
        uploading: false,
        progress: 0,
        downloadUrl: '',

        handleFile(e) { this.file = e.target.files[0]; },
        handleDrop(e) { this.dragging = false; this.file = e.dataTransfer.files[0]; },

        async upload() {
          if (!this.file) return alert('Please upload a PDF!');
          if (this.compression === 'custom' && !this.customSize.trim()) return alert('Enter target size (e.g., 500KB)');

          this.uploading = true;
          this.progress = 0;

          const formData = new FormData();
          formData.append('file_1', this.file);
          formData.append('library', this.library);

          if (this.compression === 'custom') {
            formData.append('target_size', this.customSize.trim());
          } else {
            formData.append('compression_percent', this.compression);
          }

          const interval = setInterval(() => this.progress = Math.min(this.progress + 12, 90), 180);

          try {
            const res = await fetch('https://pdf-tools-jmnh.onrender.com/compress', {
              method: 'POST',
              body: formData
            });

            clearInterval(interval);
            this.progress = 100;

            if (!res.ok) {
              const err = await res.text();
              throw new Error(err);
            }

            const blob = await res.blob();
            this.downloadUrl = URL.createObjectURL(blob);
          } catch (e) {
            alert('Compression failed: ' + e.message);
          } finally {
            this.uploading = false;
          }
        }
      };
    }
  </script>
</body>
</html>
