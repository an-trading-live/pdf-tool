<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Merge PDFs – PDF Tools Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
    .drop-zone { transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); border: 2px dashed #e0e0e0; }
    .drop-zone.dragover { border-color: #6366f1; background: #eef2ff; transform: scale(1.02); box-shadow: 0 4px 6px rgba(99, 102, 241, 0.1); }
    .progress-bar { height: 4px; background: linear-gradient(to right, #4f46e5, #a855f7); transition: width 0.4s ease-out; }
    .btn-download { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.1), 0 4px 6px -2px rgba(99, 102, 241, 0.05); transition: all 0.3s ease; }
    .btn-download:hover { transform: translateY(-2px); box-shadow: 0 15px 20px -5px rgba(99, 102, 241, 0.2); }
    .pulse { animation: pulse 2s infinite ease-in-out; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    .fade-in { animation: fadeIn 0.5s ease-in; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">

  <!-- Back Button -->
  <div class="max-w-3xl mx-auto mb-8">
    <a href="index.html" class="inline-flex items-center text-indigo-600 hover:text-indigo-800 font-medium text-sm">
      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      Back to Dashboard
    </a>
  </div>

  <div class="max-w-3xl mx-auto" x-data="mergeTool()">
    <div class="text-center mb-12 fade-in">
      <h1 class="text-4xl font-bold text-gray-900 mb-2">Merge PDFs</h1>
      <p class="text-lg text-gray-600">Combine two PDFs using your preferred engine.</p>
    </div>

    <!-- File 1 Upload -->
    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">PDF File 1</label>
      <div class="drop-zone rounded-xl p-6 bg-white shadow-md cursor-pointer"
           :class="{ 'dragover': dragging1 }"
           @dragover.prevent="dragging1 = true"
           @dragleave.prevent="dragging1 = false"
           @drop.prevent="handleDrop1($event)"
           @click="$refs.file1.click()">
        <input type="file" accept=".pdf" x-ref="file1" class="hidden" @change="handleFile1($event)" />
        <div class="text-center">
          <svg class="w-12 h-12 mx-auto mb-3 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
          </svg>
          <p class="text-sm text-gray-600" x-show="!file1">Drag & drop or click to upload PDF 1</p>
          <p class="text-sm font-medium text-indigo-600" x-show="file1" x-text="file1.name"></p>
        </div>
      </div>
    </div>

    <!-- File 2 Upload -->
    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">PDF File 2</label>
      <div class="drop-zone rounded-xl p-6 bg-white shadow-md cursor-pointer"
           :class="{ 'dragover': dragging2 }"
           @dragover.prevent="dragging2 = true"
           @dragleave.prevent="dragging2 = false"
           @drop.prevent="handleDrop2($event)"
           @click="$refs.file2.click()">
        <input type="file" accept=".pdf" x-ref="file2" class="hidden" @change="handleFile2($event)" />
        <div class="text-center">
          <svg class="w-12 h-12 mx-auto mb-3 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
          </svg>
          <p class="text-sm text-gray-600" x-show="!file2">Drag & drop or click to upload PDF 2</p>
          <p class="text-sm font-medium text-indigo-600" x-show="file2" x-text="file2.name"></p>
        </div>
      </div>
    </div>

    <!-- Merge Engine Dropdown -->
    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">Merge Engine</label>
      <select x-model="library" class="w-full rounded-xl border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
        <option value="pypdf">pypdf – Modern & Recommended</option>
        <option value="PyPDF2">PyPDF2 – Legacy</option>
        <option value="pdfrw">pdfrw – Lightweight</option>
        <option value="fitz">PyMuPDF (fitz) – Fast & Accurate</option>
        <option value="PyPDF4">PyPDF4 – Fork</option>
        <option value="PyPDF3">PyPDF3 – Fork</option>
        <option value="pdfplumber">pdfplumber – Text-focused</option>
      </select>
    </div>

    <!-- Merge Button -->
    <button @click="upload" :disabled="uploading" class="w-full py-3 px-4 bg-indigo-600 text-white font-semibold rounded-xl shadow-md hover:bg-indigo-700 transition disabled:opacity-50">
      <span x-show="!uploading">Merge PDFs</span>
      <span x-show="uploading">Merging...</span>
    </button>

    <!-- Progress -->
    <div class="mt-6" x-show="uploading">
      <div class="bg-indigo-100 rounded-full overflow-hidden">
        <div class="progress-bar" :style="{ width: progress + '%' }"></div>
      </div>
      <p class="text-center text-sm text-gray-600 mt-2" x-text="`Merging... ${progress}%`"></p>
    </div>

    <!-- Download -->
    <div class="mt-6" x-show="downloadUrl">
      <a :href="downloadUrl" download="merged.pdf" class="block py-3 px-4 bg-green-600 text-white font-semibold rounded-xl shadow-md hover:bg-green-700 transition pulse text-center">
        Download Merged PDF
      </a>
    </div>
  </div>

  <script>
    function mergeTool() {
      return {
        file1: null, file2: null,
        dragging1: false, dragging2: false,
        library: 'pypdf',  // default
        uploading: false,
        progress: 0,
        downloadUrl: '',

        handleFile1(e) { this.file1 = e.target.files[0]; },
        handleDrop1(e) { this.dragging1 = false; this.file1 = e.dataTransfer.files[0]; },
        handleFile2(e) { this.file2 = e.target.files[0]; },
        handleDrop2(e) { this.dragging2 = false; this.file2 = e.dataTransfer.files[0]; },

        async upload() {
          if (!this.file1 || !this.file2) return alert('Please upload both PDF files!');

          this.uploading = true;
          this.progress = 0;

          const formData = new FormData();
          formData.append('file_1', this.file1);
          formData.append('file_2', this.file2);
          formData.append('library', this.library);  // ← sent to backend

          const interval = setInterval(() => this.progress = Math.min(this.progress + 12, 90), 180);

          try {
            const res = await fetch('https://pdf-tools-jmnh.onrender.com/merge', {
              method: 'POST',
              body: formData
            });

            clearInterval(interval);
            this.progress = 100;

            if (!res.ok) {
              const err = await res.text();
              throw new Error(err || 'Merge failed');
            }

            const blob = await res.blob();
            this.downloadUrl = URL.createObjectURL(blob);
          } catch (e) {
            alert('Merge failed: ' + e.message);
          } finally {
            this.uploading = false;
          }
        }
      };
    }
  </script>
</body>
</html>
